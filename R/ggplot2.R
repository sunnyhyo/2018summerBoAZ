library(ggplot2)
install.packages('gcookbook')
library(gcookbook)
library(dplyr)
library(reshape2)

# ???? ?????? ??????
str(mtcars['wt','mpg'])
plot(mtcars$wt, mtcars$mpg)
qplot(mtcars$wt, mtcars$mpg)
ggplot(mtcars, aes(x = wt, y = mpg)) + geom_point()

tophit <- tophitters2001[1:25,]
tophit <- tophit[,c("name", "lg", "avg")]
str(tophit)
# y?? ?????? ?????? 
ggplot(tophit, aes(x = avg, y = name, col=lg)) + geom_point()

# ?????? ???????????? & ?????? ???? ?????? & ?????? ???????????????? ??????
### reorder(x,y) x?? y?????????? ??????????, theme 
ggplot(tophit, aes(x = avg, y = reorder(name, avg))) + geom_point(size = 3) + theme_bw() + 
  theme(panel.grid.major.x = element_blank(),
        panel.grid.minor.x = element_blank(),
        panel.grid.major.y = element_line(color = "grey60", linetype = "dashed"))

# x, y?? ?????? ?????? & ?????? ???? ?????? & ?????? ???????????????? ?????? & X?? ?? ???????? ?? ????
### angle?????? ????, hjust?? 
ggplot(tophit, aes(x = reorder(name, avg), y = avg)) + geom_point(size = 3) + theme_bw() + 
  theme(axis.text.x = element_text(angle = 60, hjust = 1),
        panel.grid.major.y = element_blank(),
        panel.grid.minor.y = element_blank(),
        panel.grid.major.x = element_line(color = "grey60", linetype = "dashed"))

# ???? ?????? ???????????? ??????
nameorder <- tophit$name[order(tophit$lg, tophit$avg)]
tophit$name <- factor(tophit$name, levels = nameorder)

# ???? ???? ???????? ?????? ?????? ???????? ????, ???????????? ?????? ???? [ geom_segment ]
ggplot(tophit, aes(x = avg, y = name)) +
  geom_segment(aes(yend = name), xend = 0, color = "grey50") + geom_point(size = 3, aes(color = lg)) +
  scale_color_brewer(palette = "Set1", limits = c("NL", "AL")) + theme_bw() +
  theme(panel.grid.major.y = element_blank(), legend.position = c(1, 0.55), # ?????? ?????? ???????????? ????
        legend.justification = c(1, 0.5))



# ???? ?? ?????? ????
# ????????
ggplot(heightweight, aes(x = ageYear, y = heightIn, color = sex)) + geom_point()

# ?????? ???? ????
ggplot(heightweight, aes(x = ageYear, y = heightIn, shape = sex)) + geom_point()

ggplot(heightweight, aes(x = ageYear, y = heightIn, color = sex, shape = sex)) + geom_point() +
  scale_shape_manual(values = c(1,2)) + scale_color_brewer(palette = "Set1")

ggplot(heightweight, aes(x = ageYear, y = heightIn, color = sex, shape = sex)) + geom_point() +
  scale_shape_manual(values = c(3,2)) + scale_color_brewer(palette = "Set1")



# ?????? ?????? ????????
sp <- ggplot(ChickWeight, aes(x = Time, y = weight)) 
sp + geom_point(color = "blue") + stat_smooth(method = lm, se = TRUE, color = "red") 

sp + geom_jitter(color = "blue") + stat_smooth(method = lm, se = TRUE, color = "red")

#???? ?? ?????? ????????
sps <- ggplot(heightweight, aes(x = ageYear, y = heightIn, color = sex)) + 
  geom_point() + scale_color_brewer(palette = "Set1")
sps + geom_smooth()


#???????????? ???????? ???? ??????
sp <- ggplot(subset(countries, Year == 2009 & healthexp > 2000),
             aes(x = healthexp, y = infmortality)) + geom_point()

# ???????? ???? ???????? ?????? ???? ??????
sp + annotate("text", x = 4350, y = 5.4, label = "Canada") + 
  annotate("text", x = 7400, y = 6.8, label = "USA")

# ?????? ???????? ?????? ??????
sp + geom_text(aes(label = Name), size = 4)


# ?????? ?????????? ???????????? ???????? ???? ????????
sp + geom_text(aes(y = infmortality + 0.1, label = Name), size = 4, vjust = 0)

sp + geom_text(aes(x = healthexp + 100, label = Name), size = 4, hjust = 0)

# ???????? ???? ???? ??????
cdat <- subset(countries, Year == 2009 & healthexp > 2000)
cdat$Name1 <- cdat$Name 
idx <- cdat$Name %in% c("Andorra", "France", "Canada") 
cdat$Name1[!idx] <- NA
ggplot(cdat, aes(x = healthexp, y = infmortality)) + geom_point() + geom_text(aes(y = infmortality + 0.1, label = Name1), size = 4, vjust = 0)


######################################################################################
## scatter + line plot  (geom_point/ geom_line)
######################################################################################
plot(pressure$temperature, pressure$pressure, type = "l")
points(pressure$temperature, pressure$pressure)

qplot(temperature, pressure, data = pressure, geom = c("line", "point"))

ggplot(pressure, aes(x = temperature, y = pressure)) + geom_point() + geom_line()

######################################################################################
## line plot  (geom_line)
######################################################################################
ggplot(BOD, aes(x = Time, y = demand)) + geom_line() + ylim(0, max(BOD$demand))

ggplot(BOD, aes(x = Time, y = demand)) + geom_line() + expand_limits(y = 0)

ggplot(BOD, aes(x = Time, y = demand)) + geom_line() + geom_point()

# ?????? ???????? ???? ???? 
tg <- ddply(ToothGrowth, c("supp", "dose"), summarize, length = mean(len))
# ???????????? ????
ggplot(tg, aes(x = dose, y = length, color = supp)) + geom_line()

ggplot(tg, aes(x = factor(dose), y = length, color = supp, group = supp)) + geom_line()

# group = supp ????! : ?? ???????? ?????????? ???????? ?????? ?????? ?????? ????
# Line type???????? ????
ggplot(tg, aes(x = dose, y = length, linetype = supp)) + geom_line()

# ?????? ?????? ????
ggplot(tg, aes(x = dose, y = length, shape = supp)) + geom_line() + geom_point(size = 4)

# ?????? ???????????? ????
ggplot(tg, aes(x = dose, y = length, fill = supp)) + geom_line() + geom_point(size = 4, shape = 21)

# ?? ???? ?????? [ linetype ]
ggplot(tg, aes(x = dose, y = length, color = supp)) + geom_line(linetype = "dashed") +
  geom_point(shape = 22, size = 3, fill = "white")

# ?????? ???? ?????? [ shape ]
#################################
pd <- position_dodge(0.2)       #
#################################

ggplot(tg, aes(x = dose, y = length, fill = supp)) + geom_line(position = pd) + 
  geom_point(shape = 21, size = 5, position = pd) + 
  scale_fill_manual(values = c("black", "white"))


# sample Data
sunspotyear <- data.frame(Year     = as.numeric(time(sunspot.year)),
                          Sunspots = as.numeric(sunspot.year))
# ???????? ???? ?????? ??????
ggplot(sunspotyear, aes(x = Year, y = Sunspots)) + geom_area()

# ???????? ???????????? ???????????? [ alpha ]
ggplot(sunspotyear, aes(x = Year, y = Sunspots)) + geom_area(color = "black", fill = "blue", alpha = 0.5)

# ???? ???? ?????? ??????
ggplot(uspopage, aes(x = Year, y = Thousands, fill = AgeGroup)) + geom_area()

# ???????? ?????????? ????
ggplot(uspopage, aes(x = Year, y = Thousands, fill = AgeGroup)) + geom_area(color = "black", size = 0.2, alpha = 0.4) + 
  scale_fill_brewer(palette = "Blues", breaks = rev(levels(uspopage$AgeGroup)))


# ?????? ???????????????? & ???? ?????? ?????? 
ggplot(uspopage, aes(x = Year, y = Thousands, fill = AgeGroup, order = desc(AgeGroup))) + 
  geom_area(color = NA, alpha = 0.4) + scale_fill_brewer(palette = "Blues") + geom_line(position = "stack", size = 0.2)


#  ???????? ???? ???? ?????? ??????
uspopage_prop <- ddply(uspopage, "Year", transform, Percent = Thousands / sum(Thousands) * 100) 
ggplot(uspopage_prop, aes(x = Year, y = Percent, fill = AgeGroup)) + geom_area(color = "black", size = 0.2, alpha = 0.4) + 
  scale_fill_brewer(palette = "Blues", breaks = rev(levels(uspopage$AgeGroup)))


# ???????????? ???? ???? ????????
clim <- subset(climate, Source == "Berkeley", select = c("Year", "Anomaly10y", "Unc10y"))
# ???????? ???????????????? ???? 
ggplot(clim, aes(x = Year, y = Anomaly10y)) + 
  geom_ribbon(aes(ymin = Anomaly10y - Unc10y, ymax = Anomaly10y + Unc10y), alpha = 0.2) +
  geom_line()


######################################################################################
## barplot  (geom_bar)
######################################################################################
barplot(BOD$demand, names.arg = BOD$Time)

barplot(table(mtcars$cyl))

# x???????? ?????? ????
# qplot(BOD$Time, BOD$demand, geom = "bar", stat = "identity")
ggplot(BOD, aes(x = Time, y = demand)) + geom_bar(stat = "identity")

# x???????? ???????????? ????
# qplot(as.factor(BOD$Time), BOD$demand, geom = "bar", stat = "identity")
ggplot(BOD, aes(x = factor(Time), y = demand)) + geom_bar(stat = "identity")


# ???? ???? a????/?????? ???????????? (fill : a????/ colour(or color) : ??????)
ggplot(pg_mean, aes(x = group, y = weight)) + geom_bar(stat = "identity", fill = "lightblue", colour = "black")

# ???? ?????? ????????(?????? ???????? ???????? ?????? ???????????? ????????)  
ggplot(cabbage_exp, aes(x = Date, y = Weight, fill = Cultivar)) + geom_bar(stat = "identity", position = "dodge")

# dodge : ????? ?????? ???????? ???????????? ?????? ???? 
ggplot(cabbage_exp, aes(x = Date, y = Weight, fill = Cultivar)) + geom_bar(stat = "identity", position = "dodge", color = "black") + 
  scale_fill_brewer(palette = "Pastel1")

# ?????? ???? ?????? ?????? 
# x?? ??????
ggplot(diamonds, aes(x = cut)) + geom_bar()

# x?? ??????
ggplot(diamonds, aes(x = carat)) + geom_bar()

# ???? ???? ????/ ?? ???? ????????????(reorder) 
upc <- subset(uspopchange, rank(Change) > 40)
ggplot(upc, aes(x = reorder(Abb, Change), y = Change, fill = Region)) + geom_bar(stat = "identity", color = "black") +
  scale_fill_manual(values = c("#669933", "#FFCC66")) + xlab("State")

# ????/???????? ???? ???????????? ???? (???? inde?? ?????? ???? ?????? ????????)
csub <- subset(climate, Source == "Berkeley" & Year >= 1900 )
csub$pos <- csub$Anomaly10y >= 0
ggplot(csub, aes(x = Year, y = Anomaly10y, fill = pos)) + geom_bar(stat = "identity", position = "identity")

# ???? ?????? ?????? ???? ????????(size) / ???? ??????(guide = FALSE)
ggplot(csub, aes(x = Year, y = Anomaly10y, fill = pos)) + geom_bar(stat = "identity", position = "identity", color = "black", size = 0.0001) + 
  scale_fill_manual(values = c("#CCEEFF", "#FFDDDD"), guide = FALSE)

# ???? ????/ ???? ????????????(width : ???? ?????? 1)
ggplot(pg_mean, aes(x = group, y = weight)) + geom_bar(stat = "identity", width = 0.5)

# ???? ???? ???? ???? ???????????? (default : 0.9) 
ggplot(cabbage_exp, aes(x = Date, y = Weight, fill = Cultivar)) + geom_bar(stat = "identity", width = 0.4, position = "dodge")

# ???? ???? ???????? ???? ???????? (default : 0.9)
ggplot(cabbage_exp, aes(x = Date, y = Weight, fill = Cultivar)) + geom_bar(stat = "identity", width = 0.3, position = position_dodge(0.5))

# ???? ???? ?????? (reverse = TRUE) 
ggplot(cabbage_exp, aes(x = Date, y = Weight, fill = Cultivar)) + geom_bar(stat = "identity") + guides(fill = guide_legend(reverse = TRUE))

# ???? ???? ???? ??????  
ggplot(cabbage_exp, aes(x = Date, y = Weight, fill = Cultivar, order = desc(Cultivar))) + geom_bar(stat = "identity")

# ???????? ???? ???? ?????? ??????(???? ??u?? 100%?? ??????)
ce <- ddply(cabbage_exp, "Date", transform, percent_weight = Weight / sum(Weight) * 100)
ggplot(ce, aes(x = Date, y = percent_weight, fill = Cultivar)) + geom_bar(stat = "identity")


# ????? ???? ???????? [ geom_text ]
# ?? ???? [ vjust < 0 ]
ggplot(cabbage_exp, aes(x = interaction(Date, Cultivar), y = Weight)) + geom_bar(stat = "identity") + 
  geom_text(aes(label = Weight), vjust = -0.2)

# ?? ???? [ vjust > 0 ]
ggplot(cabbage_exp, aes(x = interaction(Date, Cultivar), y = Weight)) + geom_bar(stat = "identity") + 
  geom_text(aes(label = Weight), vjust = 1.5, color = "white")


# ?????? ???????? ????????
# max(??????)?? ????????
ggplot(cabbage_exp, aes(x = interaction(Date, Cultivar), y = Weight)) + geom_bar(stat = "identity") +
  geom_text(aes(label = Weight), vjust = -0.2) + ylim(0, max(cabbage_exp$Weight) * 1.05)


# ?????? ???????? ???????? ???????? ?????????? ????????(???????? ???? ???? ????????????)
ggplot(cabbage_exp, aes(x = interaction(Date, Cultivar), y = Weight)) + geom_bar(stat = "identity") +
  geom_text(aes(y = Weight + 0.1, label = Weight)) 


######################################################################################
## histogram  (geom_histogram)
######################################################################################
hist(mtcars$mpg)

# ????(bin) ???? ????????
hist(mtcars$mpg, breaks = 10)

qplot(mpg, data = mtcars, binwidth = 4)

# ggplot(mtcars, aes(x = mpg)) + geom_histogram() 
ggplot(mtcars, aes(x = mpg)) + geom_histogram(binwidth = 4)

h <- ggplot(faithful, aes(x = waiting))
h + geom_histogram(binwidth = 8, fill = "white", color = "black", origin = 31)

# ???????? ???????? ???????? ?????????? ??????
library(MASS)
ggplot(birthwt, aes(x = bwt)) + geom_histogram(fill = "white", color = "black") + facet_grid(smoke ~ .)

ggplot(birthwt, aes(x = bwt)) + geom_histogram(fill = "white", color = "black") + facet_grid(smoke ~ .)

# ???? ???? ???????? 
birthwt1 <- birthwt
birthwt1$smoke <- factor(birthwt1$smoke)
levels(birthwt1$smoke)

birthwt$smoke <- revalue(birthwt1$smoke, c("0" = "Nosmoke", "1" = "Smoke"))

ggplot(birthwt, aes(x = bwt)) + geom_histogram(fill = "white", color = "black") + facet_grid(smoke ~ ., scales = "free")

######################################################################################
## boxplot  (geom_boxplot)
######################################################################################
boxplot(len ~ supp, data = ToothGrowth)

qplot(ToothGrowth$supp, ToothGrowth$len, geom = "boxplot")

ggplot(ToothGrowth, aes(x = supp, y = len))+ geom_boxplot()


######################################################################################
## ???????? ??????  (stat_function)
######################################################################################
# ?????????? ????????
myfun <- function(xvar){
  1/(1 + exp(-xvar + 10))
}

curve(myfun(x), from = 0, to = 20)
curve(1-myfun(x), add = TRUE, col = "red")

# qplot(c(0,20), fun = myfun, stat = "function", geom = "line")
ggplot(data.frame(x = c(0,20)), aes(x =x)) + stat_function(fun = myfun, geom = "line")



# top 50?? ???? ?? ???????? ???? ?????? ??????
# http://r-statistics.co/Top50-Ggplot2-Visualizations-MasterList-R-Code.html